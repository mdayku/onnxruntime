<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>best - Neural Architecture</title>
    <link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@300;400;500;600&display=swap" rel="stylesheet">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        :root {
            --bg-deep: #000000;
            --bg-primary: #0a0a0a;
            --bg-elevated: #1a1a1a;
            --bg-glass: rgba(255, 255, 255, 0.03);
            --text-primary: rgba(255, 255, 255, 0.92);
            --text-secondary: rgba(255, 255, 255, 0.55);
            --text-tertiary: rgba(255, 255, 255, 0.35);
            --accent: #0A84FF;
            --accent-glow: rgba(10, 132, 255, 0.3);
            --border: rgba(255, 255, 255, 0.08);
            --success: #30D158;
            --warning: #FFD60A;
            --error: #FF453A;
            --purple: #BF5AF2;
            --orange: #FF9F0A;
            --teal: #64D2FF;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', sans-serif;
            background: var(--bg-deep);
            color: var(--text-primary);
            overflow: hidden;
            -webkit-font-smoothing: antialiased;
        }

        .container {
            display: flex;
            height: 100vh;
        }

        .sidebar {
            width: 280px;
            background: var(--bg-primary);
            border-right: 1px solid var(--border);
            padding: 32px 24px;
            overflow-y: auto;
            backdrop-filter: blur(20px);
        }

        .sidebar h1 {
            font-size: 1.25rem;
            font-weight: 600;
            letter-spacing: -0.02em;
            margin-bottom: 32px;
            background: linear-gradient(135deg, #fff 0%, rgba(255,255,255,0.7) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .sidebar h2 {
            font-size: 0.6875rem;
            font-weight: 500;
            color: var(--text-tertiary);
            margin: 24px 0 12px;
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }

        .stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .stat-card {
            background: var(--bg-glass);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            transition: all 0.3s cubic-bezier(0.25, 0.1, 0.25, 1);
        }

        .stat-card:hover {
            background: rgba(255, 255, 255, 0.06);
            transform: translateY(-1px);
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 600;
            letter-spacing: -0.03em;
            background: linear-gradient(135deg, var(--accent) 0%, var(--teal) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-label {
            font-size: 0.6875rem;
            color: var(--text-tertiary);
            margin-top: 4px;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .btn {
            padding: 8px 14px;
            background: var(--bg-glass);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.75rem;
            font-weight: 500;
            transition: all 0.2s cubic-bezier(0.25, 0.1, 0.25, 1);
        }

        .btn:hover {
            background: var(--accent);
            border-color: var(--accent);
            color: white;
            box-shadow: 0 4px 16px var(--accent-glow);
        }

        .legend-item {
            display: flex;
            align-items: center;
            padding: 6px 0;
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .legend-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 10px;
            box-shadow: 0 0 8px currentColor;
        }

        .main {
            flex: 1;
            position: relative;
            background: radial-gradient(ellipse at center, #0a0a0a 0%, #000 100%);
        }

        /* Subtle grid pattern */
        .main::before {
            content: '';
            position: absolute;
            inset: 0;
            background-image:
                linear-gradient(rgba(255,255,255,0.02) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255,255,255,0.02) 1px, transparent 1px);
            background-size: 40px 40px;
            pointer-events: none;
        }

        svg {
            width: 100%;
            height: 100%;
        }

        .node {
            cursor: pointer;
        }

        .node:hover .node-circle {
            filter: brightness(1.2) drop-shadow(0 0 12px currentColor);
        }

        .node-circle {
            stroke: rgba(255,255,255,0.1);
            stroke-width: 1;
            filter: drop-shadow(0 2px 8px rgba(0,0,0,0.4));
        }

        .node-label {
            font-size: 9px;
            font-weight: 500;
            fill: white;
            text-anchor: middle;
            dominant-baseline: middle;
            pointer-events: none;
            text-shadow: 0 1px 2px rgba(0,0,0,0.8);
        }

        .node-sublabel {
            font-size: 7px;
            fill: rgba(255,255,255,0.5);
            text-anchor: middle;
            pointer-events: none;
        }

        .edge {
            fill: none;
            stroke-linecap: round;
            opacity: 0.6;
        }

        .edge:hover {
            opacity: 1;
            stroke-width: 3;
        }

        .tooltip {
            position: absolute;
            background: rgba(20, 20, 20, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            font-size: 0.8125rem;
            pointer-events: none;
            opacity: 0;
            transform: translateY(4px);
            transition: all 0.2s cubic-bezier(0.25, 0.1, 0.25, 1);
            max-width: 280px;
            z-index: 100;
            box-shadow: 0 8px 32px rgba(0,0,0,0.6);
        }

        .tooltip.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .tooltip-title {
            font-weight: 600;
            font-size: 0.9375rem;
            margin-bottom: 6px;
            color: var(--accent);
        }

        .tooltip-desc {
            font-size: 0.75rem;
            color: var(--text-secondary);
            line-height: 1.4;
            margin-bottom: 12px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
        }

        .tooltip-row {
            display: flex;
            justify-content: space-between;
            padding: 3px 0;
            font-size: 0.75rem;
        }

        .tooltip-label {
            color: var(--text-tertiary);
        }

        .tooltip-value {
            color: var(--text-primary);
            font-weight: 500;
            font-family: 'SF Mono', 'Menlo', monospace;
        }

        .block-indicator {
            position: absolute;
            top: -6px;
            right: -6px;
            width: 14px;
            height: 14px;
            background: var(--accent);
            border-radius: 50%;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            box-shadow: 0 2px 8px var(--accent-glow);
        }

        /* Zoom controls */
        .zoom-controls {
            position: absolute;
            bottom: 24px;
            right: 24px;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .zoom-btn {
            width: 36px;
            height: 36px;
            background: rgba(20, 20, 20, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .zoom-btn:hover {
            background: var(--bg-elevated);
            color: var(--text-primary);
        }
    </style>
</head>
<body>
    <div class="container">
        <aside class="sidebar">
            <h1>best</h1>

            <h2>Overview</h2>
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-value" id="node-count">0</div>
                    <div class="stat-label">Nodes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="edge-count">0</div>
                    <div class="stat-label">Edges</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="peak-memory">0</div>
                    <div class="stat-label">Peak Memory</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="depth">0</div>
                    <div class="stat-label">Depth</div>
                </div>
            </div>

            <h2>Navigation</h2>
            <div class="controls">
                <button class="btn" onclick="expandAll()">Expand</button>
                <button class="btn" onclick="collapseAll()">Collapse</button>
                <button class="btn" onclick="fitToScreen()">Fit</button>
                <button class="btn" onclick="resetZoom()">Reset</button>
            </div>

            <h2>Visualization</h2>
            <div class="controls">
                <button class="btn" id="heatmap-btn" onclick="toggleHeatMap()">Compute Heat Map</button>
            </div>

            <h2>Architecture</h2>
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-dot" style="color: #4A90D9;"></div>
                    <span>Convolution</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="color: #BF5AF2;"></div>
                    <span>Linear</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="color: #FF9F0A;"></div>
                    <span>Attention</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="color: #64D2FF;"></div>
                    <span>Normalization</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="color: #FFD60A;"></div>
                    <span>Activation</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="color: #30D158;"></div>
                    <span>Skip</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="color: #FF453A;"></div>
                    <span>Bottleneck</span>
                </div>
            </div>
        </aside>

        <main class="main">
            <svg id="graph"></svg>
            <div class="tooltip" id="tooltip"></div>
            <div class="zoom-controls">
                <button class="zoom-btn" onclick="zoomIn()">+</button>
                <button class="zoom-btn" onclick="zoomOut()">-</button>
            </div>
        </main>
    </div>

    <script>
        // Embedded graph data
        const graphData = {"root": {"id": "root", "name": "best", "display_name": "best", "node_type": "model", "op_type": null, "depth": 0, "is_collapsed": false, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 396, "inputs": [], "outputs": [], "attributes": {}, "children": [{"id": "op_Constant_30", "name": "Constant_30", "display_name": "Constant_30", "node_type": "op", "op_type": "Constant", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": [], "outputs": ["onnx::Split_217"], "attributes": {}}, {"id": "op_/model.2/Split", "name": "/model.2/Split", "display_name": "/model.2/Split", "node_type": "op", "op_type": "Split", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.2/cv1/act/Mul_output_0", "onnx::Split_217"], "outputs": ["/model.2/Split_output_0", "/model.2/Split_output_1"], "attributes": {}}, {"id": "op_Constant_63", "name": "Constant_63", "display_name": "Constant_63", "node_type": "op", "op_type": "Constant", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": [], "outputs": ["onnx::Split_251"], "attributes": {}}, {"id": "op_/model.4/Split", "name": "/model.4/Split", "display_name": "/model.4/Split", "node_type": "op", "op_type": "Split", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.4/cv1/act/Mul_output_0", "onnx::Split_251"], "outputs": ["/model.4/Split_output_0", "/model.4/Split_output_1"], "attributes": {}}, {"id": "op_Constant_117", "name": "Constant_117", "display_name": "Constant_117", "node_type": "op", "op_type": "Constant", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": [], "outputs": ["onnx::Split_306"], "attributes": {}}, {"id": "op_/model.6/Split", "name": "/model.6/Split", "display_name": "/model.6/Split", "node_type": "op", "op_type": "Split", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.6/cv1/act/Mul_output_0", "onnx::Split_306"], "outputs": ["/model.6/Split_output_0", "/model.6/Split_output_1"], "attributes": {}}, {"id": "op_/model.6/Concat", "name": "/model.6/Concat", "display_name": "/model.6/Concat", "node_type": "op", "op_type": "Concat", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.6/Split_output_0", "/model.6/Split_output_1", "/model.6/m.0/Add_output_0", "/model.6/m.1/Add_output_0", "/model.6/m.2/Add_output_0", "/model.6/m.3/Add_output_0", "/model.6/m.4/Add_output_0", "/model.6/m.5/Add_output_0"], "outputs": ["/model.6/Concat_output_0"], "attributes": {}}, {"id": "op_/model.8/Split", "name": "/model.8/Split", "display_name": "/model.8/Split", "node_type": "op", "op_type": "Split", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.8/cv1/act/Mul_output_0", "onnx::Split_306"], "outputs": ["/model.8/Split_output_0", "/model.8/Split_output_1"], "attributes": {}}, {"id": "op_/model.8/Concat", "name": "/model.8/Concat", "display_name": "/model.8/Concat", "node_type": "op", "op_type": "Concat", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.8/Split_output_0", "/model.8/Split_output_1", "/model.8/m.0/Add_output_0", "/model.8/m.1/Add_output_0", "/model.8/m.2/Add_output_0"], "outputs": ["/model.8/Concat_output_0"], "attributes": {}}, {"id": "op_/model.9/m/MaxPool", "name": "/model.9/m/MaxPool", "display_name": "/model.9/m/MaxPool", "node_type": "op", "op_type": "MaxPool", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.9/cv1/act/Mul_output_0"], "outputs": ["/model.9/m/MaxPool_output_0"], "attributes": {}}, {"id": "op_/model.9/m_1/MaxPool", "name": "/model.9/m_1/MaxPool", "display_name": "/model.9/m_1/MaxPool", "node_type": "op", "op_type": "MaxPool", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.9/m/MaxPool_output_0"], "outputs": ["/model.9/m_1/MaxPool_output_0"], "attributes": {}}, {"id": "op_/model.9/m_2/MaxPool", "name": "/model.9/m_2/MaxPool", "display_name": "/model.9/m_2/MaxPool", "node_type": "op", "op_type": "MaxPool", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.9/m_1/MaxPool_output_0"], "outputs": ["/model.9/m_2/MaxPool_output_0"], "attributes": {}}, {"id": "op_/model.9/Concat", "name": "/model.9/Concat", "display_name": "/model.9/Concat", "node_type": "op", "op_type": "Concat", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.9/cv1/act/Mul_output_0", "/model.9/m/MaxPool_output_0", "/model.9/m_1/MaxPool_output_0", "/model.9/m_2/MaxPool_output_0"], "outputs": ["/model.9/Concat_output_0"], "attributes": {}}, {"id": "op_/model.10/Constant", "name": "/model.10/Constant", "display_name": "/model.10/Constant", "node_type": "op", "op_type": "Constant", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": [], "outputs": ["/model.10/Constant_output_0"], "attributes": {}}, {"id": "op_/model.10/Resize", "name": "/model.10/Resize", "display_name": "/model.10/Resize", "node_type": "op", "op_type": "Resize", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.9/cv2/act/Mul_output_0", "", "/model.10/Constant_output_0"], "outputs": ["/model.10/Resize_output_0"], "attributes": {}}, {"id": "op_/model.11/Concat", "name": "/model.11/Concat", "display_name": "/model.11/Concat", "node_type": "op", "op_type": "Concat", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.10/Resize_output_0", "/model.6/cv2/act/Mul_output_0"], "outputs": ["/model.11/Concat_output_0"], "attributes": {}}, {"id": "op_/model.12/Split", "name": "/model.12/Split", "display_name": "/model.12/Split", "node_type": "op", "op_type": "Split", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.12/cv1/act/Mul_output_0", "onnx::Split_306"], "outputs": ["/model.12/Split_output_0", "/model.12/Split_output_1"], "attributes": {}}, {"id": "op_/model.12/Concat", "name": "/model.12/Concat", "display_name": "/model.12/Concat", "node_type": "op", "op_type": "Concat", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.12/Split_output_0", "/model.12/Split_output_1", "/model.12/m.0/cv2/act/Mul_output_0", "/model.12/m.1/cv2/act/Mul_output_0", "/model.12/m.2/cv2/act/Mul_output_0"], "outputs": ["/model.12/Concat_output_0"], "attributes": {}}, {"id": "op_/model.13/Constant", "name": "/model.13/Constant", "display_name": "/model.13/Constant", "node_type": "op", "op_type": "Constant", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": [], "outputs": ["/model.13/Constant_output_0"], "attributes": {}}, {"id": "op_/model.13/Resize", "name": "/model.13/Resize", "display_name": "/model.13/Resize", "node_type": "op", "op_type": "Resize", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.12/cv2/act/Mul_output_0", "", "/model.13/Constant_output_0"], "outputs": ["/model.13/Resize_output_0"], "attributes": {}}, {"id": "op_/model.15/Split", "name": "/model.15/Split", "display_name": "/model.15/Split", "node_type": "op", "op_type": "Split", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.15/cv1/act/Mul_output_0", "onnx::Split_251"], "outputs": ["/model.15/Split_output_0", "/model.15/Split_output_1"], "attributes": {}}, {"id": "op_/model.15/Concat", "name": "/model.15/Concat", "display_name": "/model.15/Concat", "node_type": "op", "op_type": "Concat", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.15/Split_output_0", "/model.15/Split_output_1", "/model.15/m.0/cv2/act/Mul_output_0", "/model.15/m.1/cv2/act/Mul_output_0", "/model.15/m.2/cv2/act/Mul_output_0"], "outputs": ["/model.15/Concat_output_0"], "attributes": {}}, {"id": "op_/model.17/Concat", "name": "/model.17/Concat", "display_name": "/model.17/Concat", "node_type": "op", "op_type": "Concat", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.16/act/Mul_output_0", "/model.12/cv2/act/Mul_output_0"], "outputs": ["/model.17/Concat_output_0"], "attributes": {}}, {"id": "op_/model.18/Split", "name": "/model.18/Split", "display_name": "/model.18/Split", "node_type": "op", "op_type": "Split", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.18/cv1/act/Mul_output_0", "onnx::Split_306"], "outputs": ["/model.18/Split_output_0", "/model.18/Split_output_1"], "attributes": {}}, {"id": "op_/model.18/Concat", "name": "/model.18/Concat", "display_name": "/model.18/Concat", "node_type": "op", "op_type": "Concat", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.18/Split_output_0", "/model.18/Split_output_1", "/model.18/m.0/cv2/act/Mul_output_0", "/model.18/m.1/cv2/act/Mul_output_0", "/model.18/m.2/cv2/act/Mul_output_0"], "outputs": ["/model.18/Concat_output_0"], "attributes": {}}, {"id": "op_/model.20/Concat", "name": "/model.20/Concat", "display_name": "/model.20/Concat", "node_type": "op", "op_type": "Concat", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.19/act/Mul_output_0", "/model.9/cv2/act/Mul_output_0"], "outputs": ["/model.20/Concat_output_0"], "attributes": {}}, {"id": "op_/model.21/Split", "name": "/model.21/Split", "display_name": "/model.21/Split", "node_type": "op", "op_type": "Split", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.21/cv1/act/Mul_output_0", "onnx::Split_306"], "outputs": ["/model.21/Split_output_0", "/model.21/Split_output_1"], "attributes": {}}, {"id": "op_/model.21/Concat", "name": "/model.21/Concat", "display_name": "/model.21/Concat", "node_type": "op", "op_type": "Concat", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.21/Split_output_0", "/model.21/Split_output_1", "/model.21/m.0/cv2/act/Mul_output_0", "/model.21/m.1/cv2/act/Mul_output_0", "/model.21/m.2/cv2/act/Mul_output_0"], "outputs": ["/model.21/Concat_output_0"], "attributes": {}}, {"id": "op_/model.22/cv2.0/cv2.0.2/Conv", "name": "/model.22/cv2.0/cv2.0.2/Conv", "display_name": "/model.22/cv2.0/cv2.0.2/Conv", "node_type": "op", "op_type": "Conv", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.22/cv2.0/cv2.0.1/act/Mul_output_0", "model.22.cv2.0.2.weight", "model.22.cv2.0.2.bias"], "outputs": ["/model.22/cv2.0/cv2.0.2/Conv_output_0"], "attributes": {}}, {"id": "op_/model.22/cv3.0/cv3.0.2/Conv", "name": "/model.22/cv3.0/cv3.0.2/Conv", "display_name": "/model.22/cv3.0/cv3.0.2/Conv", "node_type": "op", "op_type": "Conv", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.22/cv3.0/cv3.0.1/act/Mul_output_0", "model.22.cv3.0.2.weight", "model.22.cv3.0.2.bias"], "outputs": ["/model.22/cv3.0/cv3.0.2/Conv_output_0"], "attributes": {}}, {"id": "op_/model.22/Concat", "name": "/model.22/Concat", "display_name": "/model.22/Concat", "node_type": "op", "op_type": "Concat", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.22/cv2.0/cv2.0.2/Conv_output_0", "/model.22/cv3.0/cv3.0.2/Conv_output_0"], "outputs": ["/model.22/Concat_output_0"], "attributes": {}}, {"id": "op_/model.22/cv2.1/cv2.1.2/Conv", "name": "/model.22/cv2.1/cv2.1.2/Conv", "display_name": "/model.22/cv2.1/cv2.1.2/Conv", "node_type": "op", "op_type": "Conv", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.22/cv2.1/cv2.1.1/act/Mul_output_0", "model.22.cv2.1.2.weight", "model.22.cv2.1.2.bias"], "outputs": ["/model.22/cv2.1/cv2.1.2/Conv_output_0"], "attributes": {}}, {"id": "op_/model.22/cv3.1/cv3.1.2/Conv", "name": "/model.22/cv3.1/cv3.1.2/Conv", "display_name": "/model.22/cv3.1/cv3.1.2/Conv", "node_type": "op", "op_type": "Conv", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.22/cv3.1/cv3.1.1/act/Mul_output_0", "model.22.cv3.1.2.weight", "model.22.cv3.1.2.bias"], "outputs": ["/model.22/cv3.1/cv3.1.2/Conv_output_0"], "attributes": {}}, {"id": "op_/model.22/Concat_1", "name": "/model.22/Concat_1", "display_name": "/model.22/Concat_1", "node_type": "op", "op_type": "Concat", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.22/cv2.1/cv2.1.2/Conv_output_0", "/model.22/cv3.1/cv3.1.2/Conv_output_0"], "outputs": ["/model.22/Concat_1_output_0"], "attributes": {}}, {"id": "op_/model.22/cv2.2/cv2.2.2/Conv", "name": "/model.22/cv2.2/cv2.2.2/Conv", "display_name": "/model.22/cv2.2/cv2.2.2/Conv", "node_type": "op", "op_type": "Conv", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.22/cv2.2/cv2.2.1/act/Mul_output_0", "model.22.cv2.2.2.weight", "model.22.cv2.2.2.bias"], "outputs": ["/model.22/cv2.2/cv2.2.2/Conv_output_0"], "attributes": {}}, {"id": "op_/model.22/cv3.2/cv3.2.2/Conv", "name": "/model.22/cv3.2/cv3.2.2/Conv", "display_name": "/model.22/cv3.2/cv3.2.2/Conv", "node_type": "op", "op_type": "Conv", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.22/cv3.2/cv3.2.1/act/Mul_output_0", "model.22.cv3.2.2.weight", "model.22.cv3.2.2.bias"], "outputs": ["/model.22/cv3.2/cv3.2.2/Conv_output_0"], "attributes": {}}, {"id": "op_/model.22/Concat_2", "name": "/model.22/Concat_2", "display_name": "/model.22/Concat_2", "node_type": "op", "op_type": "Concat", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.22/cv2.2/cv2.2.2/Conv_output_0", "/model.22/cv3.2/cv3.2.2/Conv_output_0"], "outputs": ["/model.22/Concat_2_output_0"], "attributes": {}}, {"id": "op_/model.22/Constant", "name": "/model.22/Constant", "display_name": "/model.22/Constant", "node_type": "op", "op_type": "Constant", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": [], "outputs": ["/model.22/Constant_output_0"], "attributes": {}}, {"id": "op_/model.22/Constant_1", "name": "/model.22/Constant_1", "display_name": "/model.22/Constant_1", "node_type": "op", "op_type": "Constant", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": [], "outputs": ["/model.22/Constant_1_output_0"], "attributes": {}}, {"id": "op_/model.22/Constant_2", "name": "/model.22/Constant_2", "display_name": "/model.22/Constant_2", "node_type": "op", "op_type": "Constant", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": [], "outputs": ["/model.22/Constant_2_output_0"], "attributes": {}}, {"id": "op_/model.22/Reshape", "name": "/model.22/Reshape", "display_name": "/model.22/Reshape", "node_type": "op", "op_type": "Reshape", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.22/Concat_output_0", "/model.22/Constant_output_0"], "outputs": ["/model.22/Reshape_output_0"], "attributes": {}}, {"id": "op_/model.22/Reshape_1", "name": "/model.22/Reshape_1", "display_name": "/model.22/Reshape_1", "node_type": "op", "op_type": "Reshape", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.22/Concat_1_output_0", "/model.22/Constant_1_output_0"], "outputs": ["/model.22/Reshape_1_output_0"], "attributes": {}}, {"id": "op_/model.22/Reshape_2", "name": "/model.22/Reshape_2", "display_name": "/model.22/Reshape_2", "node_type": "op", "op_type": "Reshape", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.22/Concat_2_output_0", "/model.22/Constant_2_output_0"], "outputs": ["/model.22/Reshape_2_output_0"], "attributes": {}}, {"id": "op_/model.22/Concat_3", "name": "/model.22/Concat_3", "display_name": "/model.22/Concat_3", "node_type": "op", "op_type": "Concat", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.22/Reshape_output_0", "/model.22/Reshape_1_output_0", "/model.22/Reshape_2_output_0"], "outputs": ["/model.22/Concat_3_output_0"], "attributes": {}}, {"id": "op_Constant_377", "name": "Constant_377", "display_name": "Constant_377", "node_type": "op", "op_type": "Constant", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": [], "outputs": ["onnx::Split_599"], "attributes": {}}, {"id": "op_/model.22/Split", "name": "/model.22/Split", "display_name": "/model.22/Split", "node_type": "op", "op_type": "Split", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.22/Concat_3_output_0", "onnx::Split_599"], "outputs": ["/model.22/Split_output_0", "/model.22/Split_output_1"], "attributes": {}}, {"id": "op_/model.22/dfl/Constant", "name": "/model.22/dfl/Constant", "display_name": "/model.22/dfl/Constant", "node_type": "op", "op_type": "Constant", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": [], "outputs": ["/model.22/dfl/Constant_output_0"], "attributes": {}}, {"id": "op_/model.22/dfl/Reshape", "name": "/model.22/dfl/Reshape", "display_name": "/model.22/dfl/Reshape", "node_type": "op", "op_type": "Reshape", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.22/Split_output_0", "/model.22/dfl/Constant_output_0"], "outputs": ["/model.22/dfl/Reshape_output_0"], "attributes": {}}, {"id": "op_/model.22/dfl/Transpose", "name": "/model.22/dfl/Transpose", "display_name": "/model.22/dfl/Transpose", "node_type": "op", "op_type": "Transpose", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.22/dfl/Reshape_output_0"], "outputs": ["/model.22/dfl/Transpose_output_0"], "attributes": {}}, {"id": "op_/model.22/dfl/Softmax", "name": "/model.22/dfl/Softmax", "display_name": "/model.22/dfl/Softmax", "node_type": "op", "op_type": "Softmax", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.22/dfl/Transpose_output_0"], "outputs": ["/model.22/dfl/Softmax_output_0"], "attributes": {}}, {"id": "op_/model.22/dfl/conv/Conv", "name": "/model.22/dfl/conv/Conv", "display_name": "/model.22/dfl/conv/Conv", "node_type": "op", "op_type": "Conv", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.22/dfl/Softmax_output_0", "model.22.dfl.conv.weight"], "outputs": ["/model.22/dfl/conv/Conv_output_0"], "attributes": {}}, {"id": "op_/model.22/dfl/Constant_1", "name": "/model.22/dfl/Constant_1", "display_name": "/model.22/dfl/Constant_1", "node_type": "op", "op_type": "Constant", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": [], "outputs": ["/model.22/dfl/Constant_1_output_0"], "attributes": {}}, {"id": "op_/model.22/dfl/Reshape_1", "name": "/model.22/dfl/Reshape_1", "display_name": "/model.22/dfl/Reshape_1", "node_type": "op", "op_type": "Reshape", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.22/dfl/conv/Conv_output_0", "/model.22/dfl/Constant_1_output_0"], "outputs": ["/model.22/dfl/Reshape_1_output_0"], "attributes": {}}, {"id": "op_/model.22/Shape", "name": "/model.22/Shape", "display_name": "/model.22/Shape", "node_type": "op", "op_type": "Shape", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.22/dfl/Reshape_1_output_0"], "outputs": ["/model.22/Shape_output_0"], "attributes": {}}, {"id": "op_/model.22/Constant_3", "name": "/model.22/Constant_3", "display_name": "/model.22/Constant_3", "node_type": "op", "op_type": "Constant", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": [], "outputs": ["/model.22/Constant_3_output_0"], "attributes": {}}, {"id": "op_/model.22/Gather", "name": "/model.22/Gather", "display_name": "/model.22/Gather", "node_type": "op", "op_type": "Gather", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.22/Shape_output_0", "/model.22/Constant_3_output_0"], "outputs": ["/model.22/Gather_output_0"], "attributes": {}}, {"id": "op_/model.22/Constant_4", "name": "/model.22/Constant_4", "display_name": "/model.22/Constant_4", "node_type": "op", "op_type": "Constant", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": [], "outputs": ["/model.22/Constant_4_output_0"], "attributes": {}}, {"id": "op_/model.22/Constant_5", "name": "/model.22/Constant_5", "display_name": "/model.22/Constant_5", "node_type": "op", "op_type": "Constant", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": [], "outputs": ["/model.22/Constant_5_output_0"], "attributes": {}}, {"id": "op_/model.22/Constant_6", "name": "/model.22/Constant_6", "display_name": "/model.22/Constant_6", "node_type": "op", "op_type": "Constant", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": [], "outputs": ["/model.22/Constant_6_output_0"], "attributes": {}}, {"id": "op_/model.22/Div", "name": "/model.22/Div", "display_name": "/model.22/Div", "node_type": "op", "op_type": "Div", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.22/Add_output_0", "/model.22/Constant_6_output_0"], "outputs": ["/model.22/Div_output_0"], "attributes": {}}, {"id": "op_/model.22/Constant_7", "name": "/model.22/Constant_7", "display_name": "/model.22/Constant_7", "node_type": "op", "op_type": "Constant", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": [], "outputs": ["/model.22/Constant_7_output_0"], "attributes": {}}, {"id": "op_/model.22/Mul", "name": "/model.22/Mul", "display_name": "/model.22/Mul", "node_type": "op", "op_type": "Mul", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.22/Div_output_0", "/model.22/Constant_7_output_0"], "outputs": ["/model.22/Mul_output_0"], "attributes": {}}, {"id": "op_/model.22/Slice", "name": "/model.22/Slice", "display_name": "/model.22/Slice", "node_type": "op", "op_type": "Slice", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.22/dfl/Reshape_1_output_0", "/model.22/Constant_4_output_0", "/model.22/Mul_output_0", "/model.22/Constant_3_output_0"], "outputs": ["/model.22/Slice_output_0"], "attributes": {}}, {"id": "op_/model.22/Constant_8", "name": "/model.22/Constant_8", "display_name": "/model.22/Constant_8", "node_type": "op", "op_type": "Constant", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": [], "outputs": ["/model.22/Constant_8_output_0"], "attributes": {}}, {"id": "op_/model.22/Mul_1", "name": "/model.22/Mul_1", "display_name": "/model.22/Mul_1", "node_type": "op", "op_type": "Mul", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.22/Div_output_0", "/model.22/Constant_8_output_0"], "outputs": ["/model.22/Mul_1_output_0"], "attributes": {}}, {"id": "op_/model.22/Slice_1", "name": "/model.22/Slice_1", "display_name": "/model.22/Slice_1", "node_type": "op", "op_type": "Slice", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.22/dfl/Reshape_1_output_0", "/model.22/Mul_output_0", "/model.22/Mul_1_output_0", "/model.22/Constant_3_output_0"], "outputs": ["/model.22/Slice_1_output_0"], "attributes": {}}, {"id": "op_/model.22/Constant_9", "name": "/model.22/Constant_9", "display_name": "/model.22/Constant_9", "node_type": "op", "op_type": "Constant", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": [], "outputs": ["/model.22/Constant_9_output_0"], "attributes": {}}, {"id": "op_/model.22/Constant_10", "name": "/model.22/Constant_10", "display_name": "/model.22/Constant_10", "node_type": "op", "op_type": "Constant", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": [], "outputs": ["/model.22/Constant_10_output_0"], "attributes": {}}, {"id": "op_/model.22/Constant_11", "name": "/model.22/Constant_11", "display_name": "/model.22/Constant_11", "node_type": "op", "op_type": "Constant", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": [], "outputs": ["/model.22/Constant_11_output_0"], "attributes": {}}, {"id": "op_/model.22/Div_1", "name": "/model.22/Div_1", "display_name": "/model.22/Div_1", "node_type": "op", "op_type": "Div", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.22/Add_2_output_0", "/model.22/Constant_11_output_0"], "outputs": ["/model.22/Div_1_output_0"], "attributes": {}}, {"id": "op_/model.22/Constant_12", "name": "/model.22/Constant_12", "display_name": "/model.22/Constant_12", "node_type": "op", "op_type": "Constant", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": [], "outputs": ["/model.22/Constant_12_output_0"], "attributes": {}}, {"id": "op_/model.22/Mul_2", "name": "/model.22/Mul_2", "display_name": "/model.22/Mul_2", "node_type": "op", "op_type": "Mul", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.22/Concat_4_output_0", "/model.22/Constant_12_output_0"], "outputs": ["/model.22/Mul_2_output_0"], "attributes": {}}, {"id": "op_/model.22/Sigmoid", "name": "/model.22/Sigmoid", "display_name": "/model.22/Sigmoid", "node_type": "op", "op_type": "Sigmoid", "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.22/Split_output_1"], "outputs": ["/model.22/Sigmoid_output_0"], "attributes": {}}, {"id": "block_conv_block_0", "name": "conv_block_0", "display_name": "conv_block_0 x97", "node_type": "block", "op_type": null, "depth": 1, "is_collapsed": true, "is_repeated": true, "repeat_count": 97, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 194, "inputs": [], "outputs": [], "attributes": {"block_type": "ConvSigmoid"}, "children": [{"id": "op_/model.0/conv/Conv", "name": "/model.0/conv/Conv", "display_name": "/model.0/conv/Conv", "node_type": "op", "op_type": "Conv", "depth": 2, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["images", "model.0.conv.weight", "model.0.conv.bias"], "outputs": ["/model.0/conv/Conv_output_0"], "attributes": {}}, {"id": "op_/model.0/act/Sigmoid", "name": "/model.0/act/Sigmoid", "display_name": "/model.0/act/Sigmoid", "node_type": "op", "op_type": "Sigmoid", "depth": 2, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.0/conv/Conv_output_0"], "outputs": ["/model.0/act/Sigmoid_output_0"], "attributes": {}}]}, {"id": "block_residual_0", "name": "residual_0", "display_name": "residual_0 x21", "node_type": "block", "op_type": null, "depth": 1, "is_collapsed": true, "is_repeated": true, "repeat_count": 21, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 21, "inputs": [], "outputs": [], "attributes": {"inputs": ["/model.2/Split_output_1", "/model.2/m.0/cv2/act/Mul_output_0"], "variant": "standard", "block_type": "ResidualAdd"}, "children": [{"id": "op_/model.2/m.0/Add", "name": "/model.2/m.0/Add", "display_name": "/model.2/m.0/Add", "node_type": "op", "op_type": "Add", "depth": 2, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.2/Split_output_1", "/model.2/m.0/cv2/act/Mul_output_0"], "outputs": ["/model.2/m.0/Add_output_0"], "attributes": {}}]}, {"id": "block_dense_skip_0", "name": "dense_skip_0", "display_name": "dense_skip_0 x5", "node_type": "block", "op_type": null, "depth": 1, "is_collapsed": true, "is_repeated": true, "repeat_count": 5, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 5, "inputs": [], "outputs": [], "attributes": {"inputs": ["/model.2/Split_output_0", "/model.2/Split_output_1", "/model.2/m.0/Add_output_0", "/model.2/m.1/Add_output_0", "/model.2/m.2/Add_output_0"], "variant": "concat", "depth_diff": 3, "block_type": "ResidualConcat"}, "children": [{"id": "op_/model.2/Concat", "name": "/model.2/Concat", "display_name": "/model.2/Concat", "node_type": "op", "op_type": "Concat", "depth": 2, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.2/Split_output_0", "/model.2/Split_output_1", "/model.2/m.0/Add_output_0", "/model.2/m.1/Add_output_0", "/model.2/m.2/Add_output_0"], "outputs": ["/model.2/Concat_output_0"], "attributes": {}}]}, {"id": "block_gate_5", "name": "gate_5", "display_name": "gate_5 x97", "node_type": "block", "op_type": null, "depth": 1, "is_collapsed": true, "is_repeated": true, "repeat_count": 97, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 97, "inputs": [], "outputs": [], "attributes": {"inputs": ["/model.0/conv/Conv_output_0", "/model.0/act/Sigmoid_output_0"], "variant": "gated", "block_type": "ResidualGate"}, "children": [{"id": "op_/model.0/act/Mul", "name": "/model.0/act/Mul", "display_name": "/model.0/act/Mul", "node_type": "op", "op_type": "Mul", "depth": 2, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.0/conv/Conv_output_0", "/model.0/act/Sigmoid_output_0"], "outputs": ["/model.0/act/Mul_output_0"], "attributes": {}}]}, {"id": "block_sub_residual_102", "name": "sub_residual_102", "display_name": "sub_residual_102", "node_type": "block", "op_type": null, "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": [], "outputs": [], "attributes": {"inputs": ["/model.22/Constant_9_output_0", "/model.22/Slice_output_0"], "variant": "subtract", "block_type": "ResidualSub"}, "children": [{"id": "op_/model.22/Sub", "name": "/model.22/Sub", "display_name": "/model.22/Sub", "node_type": "op", "op_type": "Sub", "depth": 2, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.22/Constant_9_output_0", "/model.22/Slice_output_0"], "outputs": ["/model.22/Sub_output_0"], "attributes": {}}]}, {"id": "block_sub_residual_103", "name": "sub_residual_103", "display_name": "sub_residual_103", "node_type": "block", "op_type": null, "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": [], "outputs": [], "attributes": {"inputs": ["/model.22/Add_1_output_0", "/model.22/Sub_output_0"], "variant": "subtract", "block_type": "ResidualSub"}, "children": [{"id": "op_/model.22/Sub_1", "name": "/model.22/Sub_1", "display_name": "/model.22/Sub_1", "node_type": "op", "op_type": "Sub", "depth": 2, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": ["/model.22/Add_1_output_0", "/model.22/Sub_output_0"], "outputs": ["/model.22/Sub_1_output_0"], "attributes": {}}]}, {"id": "block_repeated_ConvSigmoid", "name": "repeated_ConvSigmoid", "display_name": "repeated_ConvSigmoid", "node_type": "block", "op_type": null, "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": [], "outputs": [], "attributes": {"repeated_type": "ConvSigmoid", "num_repetitions": 97, "block_names": ["conv_block_0", "conv_block_1", "conv_block_2", "conv_block_3", "conv_block_4", "conv_block_5", "conv_block_6", "conv_block_7", "conv_block_8", "conv_block_9", "conv_block_10", "conv_block_11", "conv_block_12", "conv_block_13", "conv_block_14", "conv_block_15", "conv_block_16", "conv_block_17", "conv_block_18", "conv_block_19", "conv_block_20", "conv_block_21", "conv_block_22", "conv_block_23", "conv_block_24", "conv_block_25", "conv_block_26", "conv_block_27", "conv_block_28", "conv_block_29", "conv_block_30", "conv_block_31", "conv_block_32", "conv_block_33", "conv_block_34", "conv_block_35", "conv_block_36", "conv_block_37", "conv_block_38", "conv_block_39", "conv_block_40", "conv_block_41", "conv_block_42", "conv_block_43", "conv_block_44", "conv_block_45", "conv_block_46", "conv_block_47", "conv_block_48", "conv_block_49", "conv_block_50", "conv_block_51", "conv_block_52", "conv_block_53", "conv_block_54", "conv_block_55", "conv_block_56", "conv_block_57", "conv_block_58", "conv_block_59", "conv_block_60", "conv_block_61", "conv_block_62", "conv_block_63", "conv_block_64", "conv_block_65", "conv_block_66", "conv_block_67", "conv_block_68", "conv_block_69", "conv_block_70", "conv_block_71", "conv_block_72", "conv_block_73", "conv_block_74", "conv_block_75", "conv_block_76", "conv_block_77", "conv_block_78", "conv_block_79", "conv_block_80", "conv_block_81", "conv_block_82", "conv_block_83", "conv_block_84", "conv_block_85", "conv_block_86", "conv_block_87", "conv_block_88", "conv_block_89", "conv_block_90", "conv_block_91", "conv_block_92", "conv_block_93", "conv_block_94", "conv_block_95", "conv_block_96"], "block_type": "RepeatedBlock"}}, {"id": "block_repeated_ResidualAdd", "name": "repeated_ResidualAdd", "display_name": "repeated_ResidualAdd", "node_type": "block", "op_type": null, "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": [], "outputs": [], "attributes": {"repeated_type": "ResidualAdd", "num_repetitions": 21, "block_names": ["residual_0", "residual_1", "residual_2", "residual_3", "residual_4", "residual_5", "residual_6", "residual_7", "residual_8", "residual_9", "residual_10", "residual_11", "residual_12", "residual_13", "residual_14", "residual_15", "residual_16", "residual_17", "residual_18", "residual_19", "residual_20"], "block_type": "RepeatedBlock"}}, {"id": "block_repeated_ResidualConcat", "name": "repeated_ResidualConcat", "display_name": "repeated_ResidualConcat", "node_type": "block", "op_type": null, "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": [], "outputs": [], "attributes": {"repeated_type": "ResidualConcat", "num_repetitions": 5, "block_names": ["dense_skip_0", "dense_skip_1", "dense_skip_2", "dense_skip_3", "dense_skip_4"], "block_type": "RepeatedBlock"}}, {"id": "block_repeated_ResidualGate", "name": "repeated_ResidualGate", "display_name": "repeated_ResidualGate", "node_type": "block", "op_type": null, "depth": 1, "is_collapsed": true, "is_repeated": false, "repeat_count": 1, "total_flops": 0, "total_params": 0, "total_memory_bytes": 0, "node_count": 1, "inputs": [], "outputs": [], "attributes": {"repeated_type": "ResidualGate", "num_repetitions": 97, "block_names": ["gate_5", "gate_6", "gate_7", "gate_8", "gate_9", "gate_10", "gate_11", "gate_12", "gate_13", "gate_14", "gate_15", "gate_16", "gate_17", "gate_18", "gate_19", "gate_20", "gate_21", "gate_22", "gate_23", "gate_24", "gate_25", "gate_26", "gate_27", "gate_28", "gate_29", "gate_30", "gate_31", "gate_32", "gate_33", "gate_34", "gate_35", "gate_36", "gate_37", "gate_38", "gate_39", "gate_40", "gate_41", "gate_42", "gate_43", "gate_44", "gate_45", "gate_46", "gate_47", "gate_48", "gate_49", "gate_50", "gate_51", "gate_52", "gate_53", "gate_54", "gate_55", "gate_56", "gate_57", "gate_58", "gate_59", "gate_60", "gate_61", "gate_62", "gate_63", "gate_64", "gate_65", "gate_66", "gate_67", "gate_68", "gate_69", "gate_70", "gate_71", "gate_72", "gate_73", "gate_74", "gate_75", "gate_76", "gate_77", "gate_78", "gate_79", "gate_80", "gate_81", "gate_82", "gate_83", "gate_84", "gate_85", "gate_86", "gate_87", "gate_88", "gate_89", "gate_90", "gate_91", "gate_92", "gate_93", "gate_94", "gate_95", "gate_96", "gate_97", "gate_98", "gate_99", "gate_100", "gate_101"], "block_type": "RepeatedBlock"}}]}, "total_nodes": 619, "depth": 2};
        const edgeData = {"total_activation_bytes": 1151772996, "peak_activation_bytes": 78643200, "peak_activation_node": "/model.0/act/Mul", "bottleneck_edges": ["/model.0/conv/Conv_output_0", "/model.0/act/Sigmoid_output_0", "/model.0/act/Mul_output_0", "/model.2/Concat_output_0", "/model.4/Concat_output_0"], "attention_edges": [], "skip_connection_edges": ["/model.2/Split_output_1", "/model.2/m.0/Add_output_0", "/model.2/m.1/Add_output_0", "/model.4/Split_output_1", "/model.4/m.0/Add_output_0", "/model.4/m.1/Add_output_0", "/model.4/m.2/Add_output_0", "/model.4/m.3/Add_output_0", "/model.4/m.4/Add_output_0", "/model.6/Split_output_1", "/model.6/m.0/Add_output_0", "/model.6/m.1/Add_output_0", "/model.6/m.2/Add_output_0", "/model.6/m.3/Add_output_0", "/model.6/m.4/Add_output_0", "/model.8/Split_output_1", "/model.8/m.0/Add_output_0", "/model.8/m.1/Add_output_0", "/model.22/Gather_output_0", "/model.22/Slice_1_output_0", "/model.22/Sub_output_0"], "num_edges": 609};

        // Get label for a node
        function getNodeLabel(node) {
            if (node.node_type === 'op' && node.op_type) {
                return node.op_type;
            }
            if (node.display_name) {
                return node.display_name;
            }
            return node.name;
        }

        // Apple-inspired color palette
        const colors = {
            conv: '#4A90D9',
            linear: '#BF5AF2',
            attention: '#FF9F0A',
            norm: '#64D2FF',
            activation: '#FFD60A',
            pool: '#30D158',
            embed: '#AF52DE',
            reshape: '#5E5CE6',
            elementwise: '#FF6482',
            reduce: '#FF453A',
            default: '#636366'
        };

        // Get color for op type
        function getNodeColor(node) {
            if (node.node_type === 'block') {
                const blockType = (node.attributes?.block_type || '').toLowerCase();
                if (blockType.includes('attention')) return colors.attention;
                if (blockType.includes('mlp') || blockType.includes('ffn')) return colors.linear;
                if (blockType.includes('conv')) return colors.conv;
                if (blockType.includes('norm')) return colors.norm;
                if (blockType.includes('embed')) return colors.embed;
                return colors.default;
            }

            const op = (node.op_type || '').toLowerCase();
            if (op.includes('conv')) return colors.conv;
            if (op.includes('matmul') || op.includes('gemm')) return colors.linear;
            if (op.includes('norm') || op.includes('layer')) return colors.norm;
            if (op.includes('relu') || op.includes('gelu') || op.includes('softmax') || op.includes('sigmoid')) return colors.activation;
            if (op.includes('pool')) return colors.pool;
            if (op.includes('reshape') || op.includes('transpose') || op.includes('flatten')) return colors.reshape;
            if (op.includes('add') || op.includes('mul') || op.includes('sub') || op.includes('div')) return colors.elementwise;
            if (op.includes('reduce')) return colors.reduce;
            return colors.default;
        }

        // Get node size based on type and compute
        function getNodeSize(node) {
            const base = node.node_type === 'model' ? 50 :
                         node.node_type === 'layer' ? 40 :
                         node.node_type === 'block' ? 35 : 24;
            // Scale up slightly for high-compute nodes
            if (node.total_flops > 1e9) return base * 1.3;
            if (node.total_flops > 1e6) return base * 1.1;
            return base;
        }

        // Heat map mode toggle
        let heatMapMode = false;

        // Get heat map color based on compute intensity
        function getHeatColor(flops, maxFlops) {
            if (!flops || flops === 0) return null;
            const intensity = Math.log10(flops + 1) / Math.log10(maxFlops + 1);
            // Blue -> Cyan -> Green -> Yellow -> Orange -> Red
            if (intensity < 0.2) return '#0A84FF';
            if (intensity < 0.4) return '#64D2FF';
            if (intensity < 0.6) return '#30D158';
            if (intensity < 0.8) return '#FFD60A';
            if (intensity < 0.9) return '#FF9F0A';
            return '#FF453A';
        }

        // Initialize visualization
        const svg = d3.select('#graph');
        const container = svg.append('g');

        // Zoom behavior
        const zoom = d3.zoom()
            .scaleExtent([0.1, 4])
            .on('zoom', (event) => {
                container.attr('transform', event.transform);
            });

        svg.call(zoom);

        // Tooltip
        const tooltip = d3.select('#tooltip');

        // Op type explanations for demystifying the model
        const opDescriptions = {
            'Conv': 'Convolution: Slides filters across input to detect features like edges, textures, shapes',
            'MatMul': 'Matrix Multiply: Core linear transformation - learns weighted combinations of inputs',
            'Gemm': 'General Matrix Multiply: Linear layer with weights and bias',
            'Relu': 'ReLU Activation: Keeps positive values, zeros negatives - adds non-linearity',
            'Gelu': 'GELU Activation: Smooth activation used in transformers - better gradients',
            'Softmax': 'Softmax: Converts scores to probabilities (sums to 1) - used in attention',
            'Sigmoid': 'Sigmoid: Squashes values to 0-1 range - used for gates/probabilities',
            'LayerNormalization': 'Layer Norm: Normalizes activations for stable training',
            'BatchNormalization': 'Batch Norm: Normalizes across batch - speeds up training',
            'Add': 'Addition: Element-wise sum - often a residual/skip connection',
            'Mul': 'Multiply: Element-wise product - used in attention and gating',
            'Div': 'Division: Often scaling (e.g., by sqrt(d) in attention)',
            'Transpose': 'Transpose: Rearranges tensor dimensions',
            'Reshape': 'Reshape: Changes tensor shape without changing data',
            'Gather': 'Gather: Lookup operation - retrieves embeddings by index',
            'Concat': 'Concatenate: Joins tensors along an axis',
            'Split': 'Split: Divides tensor into parts',
            'MaxPool': 'Max Pooling: Downsamples by taking maximum in each window',
            'GlobalAveragePool': 'Global Avg Pool: Reduces spatial dims to single values',
            'Flatten': 'Flatten: Collapses dimensions into 1D for dense layers',
            'Dropout': 'Dropout: Randomly zeros values during training for regularization',
            'Attention': 'Self-Attention: Computes relationships between all positions',
            'AttentionHead': 'Attention Head: Q/K/V projections + scaled dot-product attention',
            'MLPBlock': 'MLP/FFN: Feed-forward network - expands then contracts dimensions',
        };

        function getOpDescription(node) {
            const opType = node.op_type || node.attributes?.block_type || '';
            return opDescriptions[opType] || `${opType}: Neural network operation`;
        }

        function showTooltip(event, node) {
            const opType = node.op_type || node.node_type;
            const description = getOpDescription(node);

            // Build detailed info
            let details = '';

            // Input/output info
            if (node.inputs && node.inputs.length > 0) {
                details += `<div class="tooltip-row"><span class="tooltip-label">Inputs:</span><span class="tooltip-value">${node.inputs.length} tensor(s)</span></div>`;
            }
            if (node.outputs && node.outputs.length > 0) {
                details += `<div class="tooltip-row"><span class="tooltip-label">Outputs:</span><span class="tooltip-value">${node.outputs.length} tensor(s)</span></div>`;
            }

            // Child count for blocks
            if (node.children && node.children.length > 0) {
                details += `<div class="tooltip-row"><span class="tooltip-label">Contains:</span><span class="tooltip-value">${node.node_count || node.children.length} ops</span></div>`;
            }

            // Compute info
            if (node.total_flops > 0) {
                const intensity = node.total_flops > 1e9 ? 'high' : node.total_flops > 1e6 ? 'medium' : 'low';
                details += `<div class="tooltip-row"><span class="tooltip-label">Compute:</span><span class="tooltip-value">${formatNumber(node.total_flops)} FLOPs (${intensity})</span></div>`;
            }

            // Memory info
            if (node.total_memory_bytes > 0) {
                details += `<div class="tooltip-row"><span class="tooltip-label">Memory:</span><span class="tooltip-value">${formatBytes(node.total_memory_bytes)}</span></div>`;
            }

            const html = `
                <div class="tooltip-title">${opType}</div>
                <div class="tooltip-desc">${description}</div>
                ${details}
            `;

            tooltip.html(html)
                .style('left', (event.pageX + 15) + 'px')
                .style('top', (event.pageY + 15) + 'px')
                .classed('visible', true);
        }

        function hideTooltip() {
            tooltip.classed('visible', false);
        }

        // Force-directed layout for natural graph appearance
        function layoutNodes(nodes) {
            const width = window.innerWidth - 320;
            const height = window.innerHeight;
            const centerX = width / 2;
            const centerY = height / 2;

            // Simple force-directed positioning
            const cols = Math.ceil(Math.sqrt(nodes.length * 1.5));
            const rows = Math.ceil(nodes.length / cols);
            const spacingX = Math.min(100, (width - 100) / cols);
            const spacingY = Math.min(80, (height - 100) / rows);

            nodes.forEach((node, i) => {
                const col = i % cols;
                const row = Math.floor(i / cols);

                // Center the grid
                const startX = centerX - (cols * spacingX) / 2;
                const startY = centerY - (rows * spacingY) / 2;

                node.x = startX + col * spacingX + spacingX / 2;
                node.y = startY + row * spacingY + spacingY / 2;
                node.r = getNodeSize(node);
            });

            return nodes;
        }

        // Render graph
        function render() {
            container.selectAll('*').remove();

            // Flatten visible nodes
            const visibleNodes = [];
            function collectVisible(node) {
                visibleNodes.push(node);
                if (!node.is_collapsed && node.children) {
                    node.children.forEach(collectVisible);
                }
            }

            if (graphData.root) {
                collectVisible(graphData.root);
            }

            // Layout
            layoutNodes(visibleNodes);

            // Create node lookup for edges
            const nodeById = {};
            visibleNodes.forEach(n => {
                nodeById[n.id] = n;
                nodeById[n.name] = n;
            });

            // Draw edges first (so they're behind nodes)
            const edges = [];
            visibleNodes.forEach(node => {
                if (node.outputs) {
                    node.outputs.forEach(output => {
                        // Find nodes that consume this output
                        visibleNodes.forEach(target => {
                            if (target.inputs && target.inputs.includes(output)) {
                                edges.push({
                                    source: node,
                                    target: target,
                                    output: output
                                });
                            }
                        });
                    });
                }
            });

            // Draw curved edges
            container.selectAll('.edge')
                .data(edges)
                .enter()
                .append('path')
                .attr('class', 'edge')
                .attr('d', d => {
                    const dx = d.target.x - d.source.x;
                    const dy = d.target.y - d.source.y;
                    const dr = Math.sqrt(dx * dx + dy * dy) * 0.5;
                    return `M${d.source.x},${d.source.y} Q${(d.source.x + d.target.x)/2},${(d.source.y + d.target.y)/2 - 20} ${d.target.x},${d.target.y}`;
                })
                .attr('stroke', 'rgba(255,255,255,0.15)')
                .attr('stroke-width', 1.5);

            // Draw nodes as circles
            const nodeGroups = container.selectAll('.node')
                .data(visibleNodes)
                .enter()
                .append('g')
                .attr('class', 'node')
                .attr('transform', d => `translate(${d.x}, ${d.y})`)
                .on('mouseover', showTooltip)
                .on('mouseout', hideTooltip)
                .on('click', (event, d) => {
                    if (d.children && d.children.length > 0) {
                        d.is_collapsed = !d.is_collapsed;
                        render();
                    }
                });

            // Glow effect for nodes
            const defs = container.append('defs');
            defs.append('filter')
                .attr('id', 'glow')
                .append('feGaussianBlur')
                .attr('stdDeviation', '3')
                .attr('result', 'coloredBlur');

            // Calculate max FLOPs for heat map
            const maxFlops = getMaxFlops(visibleNodes);

            // Circle nodes - use heat map or category colors
            nodeGroups.append('circle')
                .attr('class', 'node-circle')
                .attr('r', d => d.r)
                .attr('fill', d => {
                    if (heatMapMode && d.total_flops > 0) {
                        return getHeatColor(d.total_flops, maxFlops);
                    }
                    return getNodeColor(d);
                })
                .attr('opacity', d => d.node_type === 'model' ? 0.9 : 0.85)
                .style('filter', 'url(#glow)');

            // Inner highlight
            nodeGroups.append('circle')
                .attr('r', d => d.r - 2)
                .attr('fill', 'none')
                .attr('stroke', 'rgba(255,255,255,0.2)')
                .attr('stroke-width', 1);

            // Labels
            nodeGroups.append('text')
                .attr('class', 'node-label')
                .attr('y', d => d.r > 30 ? 0 : 0)
                .text(d => truncate(getNodeLabel(d), d.r > 30 ? 12 : 6));

            // Expand indicator for blocks
            nodeGroups.filter(d => d.children && d.children.length > 0)
                .append('circle')
                .attr('cx', d => d.r * 0.7)
                .attr('cy', d => -d.r * 0.7)
                .attr('r', 8)
                .attr('fill', '#0A84FF')
                .attr('stroke', '#000')
                .attr('stroke-width', 1);

            nodeGroups.filter(d => d.children && d.children.length > 0)
                .append('text')
                .attr('x', d => d.r * 0.7)
                .attr('y', d => -d.r * 0.7 + 1)
                .attr('text-anchor', 'middle')
                .attr('dominant-baseline', 'middle')
                .attr('fill', 'white')
                .attr('font-size', '10px')
                .attr('font-weight', '600')
                .text(d => d.is_collapsed ? '+' : '-');

            // Update stats
            document.getElementById('node-count').textContent = visibleNodes.length;
            document.getElementById('edge-count').textContent = edges.length || edgeData?.num_edges || 0;
            document.getElementById('peak-memory').textContent = formatBytes(edgeData?.peak_activation_bytes || 0);
            document.getElementById('depth').textContent = graphData.depth || 0;
        }

        function zoomIn() {
            svg.transition().duration(300).call(zoom.scaleBy, 1.3);
        }

        function zoomOut() {
            svg.transition().duration(300).call(zoom.scaleBy, 0.7);
        }

        function toggleHeatMap() {
            heatMapMode = !heatMapMode;
            const btn = document.getElementById('heatmap-btn');
            btn.style.background = heatMapMode ? 'var(--accent)' : '';
            btn.style.color = heatMapMode ? 'white' : '';
            render();
        }

        // Calculate max FLOPs for heat map scaling
        function getMaxFlops(nodes) {
            let max = 0;
            nodes.forEach(n => {
                if (n.total_flops > max) max = n.total_flops;
            });
            return max || 1;
        }

        // Helper functions
        function truncate(str, len) {
            return str.length > len ? str.slice(0, len) + '...' : str;
        }

        function formatNumber(n) {
            if (n >= 1e12) return (n / 1e12).toFixed(1) + 'T';
            if (n >= 1e9) return (n / 1e9).toFixed(1) + 'G';
            if (n >= 1e6) return (n / 1e6).toFixed(1) + 'M';
            if (n >= 1e3) return (n / 1e3).toFixed(1) + 'K';
            return n.toString();
        }

        function formatBytes(bytes) {
            if (bytes >= 1e9) return (bytes / 1e9).toFixed(2) + ' GB';
            if (bytes >= 1e6) return (bytes / 1e6).toFixed(1) + ' MB';
            if (bytes >= 1e3) return (bytes / 1e3).toFixed(1) + ' KB';
            return bytes + ' B';
        }

        // Control functions
        function expandAll() {
            function expand(node) {
                node.is_collapsed = false;
                if (node.children) node.children.forEach(expand);
            }
            if (graphData.root) expand(graphData.root);
            render();
        }

        function collapseAll() {
            function collapse(node) {
                if (node.children && node.children.length > 0) {
                    node.is_collapsed = true;
                }
                if (node.children) node.children.forEach(collapse);
            }
            if (graphData.root) collapse(graphData.root);
            render();
        }

        function resetZoom() {
            svg.transition().duration(500).call(zoom.transform, d3.zoomIdentity);
        }

        function fitToScreen() {
            const bounds = container.node().getBBox();
            const parent = svg.node().parentElement;
            const fullWidth = parent.clientWidth;
            const fullHeight = parent.clientHeight;
            const width = bounds.width;
            const height = bounds.height;
            const midX = bounds.x + width / 2;
            const midY = bounds.y + height / 2;

            const scale = 0.9 / Math.max(width / fullWidth, height / fullHeight);
            const translate = [fullWidth / 2 - scale * midX, fullHeight / 2 - scale * midY];

            svg.transition().duration(500).call(
                zoom.transform,
                d3.zoomIdentity.translate(translate[0], translate[1]).scale(scale)
            );
        }

        // Initial render
        render();
        setTimeout(fitToScreen, 100);
    </script>
</body>
</html>
